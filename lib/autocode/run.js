// Generated by CoffeeScript 1.9.3
(function() {
  module.exports = function(opts) {
    var autocode, i, runCmd, scripts, spawn;
    autocode = this;
    spawn = require('cross-spawn');
    this.build(opts);
    if (!this.config.scripts || !this.config.scripts.run) {
      return 'Nothing to run.';
    }
    console.log("\nRUN:".bold);
    scripts = this.config.scripts;
    i = 0;
    runCmd = function() {
      var arg, cmd, proc, run, runInterval;
      if (!scripts.run[i]) {
        console.log("\nDone!");
        process.kill(0);
        return;
      }
      console.log('- ' + scripts.run[i]);
      run = scripts.run[i];
      run = [run.substr(0, run.indexOf(' ')), run.substr(run.indexOf(' ') + 1)];
      cmd = run[0];
      arg = run[1].split(' ');
      proc = spawn(cmd, arg);
      proc.stderr.on('data', function(data) {
        return console.log(data.toString().red);
      });
      proc.stdout.on('error', function(data) {
        return console.log(data.toString());
      });
      proc.stdout.on('data', function(data) {
        return console.log(data.toString());
      });
      proc.on('close', function(err) {
        return runCmd();
      });
      proc.on('error', function(err) {
        return console.log('run error', err);
      });
      runInterval = setInterval((function() {
        if (autocode.stopped) {
          console.log('Project was stopped.');
          autocode.stopped = false;
          clearInterval(runInterval);
          return proc.kill();
        }
      }), 1);
      return i++;
    };
    runCmd();
    return 'Running...';
  };

}).call(this);
